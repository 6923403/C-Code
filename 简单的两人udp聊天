
QT += core gui network

-------------

#include <QUdpSocket>

 //套接字

 QUdpSocket * udp;
 --------------------

{

    ui->setupUi(this);

    //初始化属性

    ui -> MyPort -> setText("8888");

    ui -> toPort -> setText("9999");

    ui -> toIp -> setText("127.0.0.1");

    //创建套接字

    udp = new QUdpSocket(this);

    //绑定自身端口号

    udp -> bind(ui -> MyPort -> text().toInt());

    //点击发送按钮 发送报文

    connect(ui -> sendBtn, &QPushButton::clicked, [=]()

    {

        //书写报文 参数1 内容  参数2  对方IP  参数3 对方端口

        udp -> writeDatagram(ui -> input -> toPlainText().toUtf8(), QHostAddress(ui -> toIp -> text()), ui -> toPort -> text().toInt());

        ui -> record -> append("My@msg:" + ui -> input -> toPlainText());

        //清空输入

        ui -> input -> clear();

    });

    connect(udp, &QUdpSocket::readyRead, [=]()

    {

        //获取报文长度

        qint64 size = udp -> pendingDatagramSize();

        QByteArray array = QByteArray(size, 0);

        //读取报文

        udp -> readDatagram(array.data(), size);

        //将数据同步到聊天记录中

        ui -> record -> append(array);

    });

    connect(ui -> cleanBtn, &QPushButton::clicked, [=]()

    {

        //清空聊天记录

        ui -> record -> clear();

    });

}

-----------
![](https://upload-images.jianshu.io/upload_images/17208096-3c459c3213dff572.png)
